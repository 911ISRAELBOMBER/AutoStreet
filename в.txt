ФОРМА ЭЛЕМЕНТА


&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если Параметры.Ключ.Пустая() Тогда
	     ПользовательНайден=Справочники.Пользователи.НайтиПоНаименованию(СокрЛП(ТекущийОбъект.Наименование),Истина);
		 Если Не ПользовательНайден.Пустая() Тогда
		     Отказ=Истина;
			 Сообщить("Такой пользователь уже существует");	
	Иначе
	     ТекущийОбъект.Активность=Истина;
		 ТекущийОбъект.КоличествоПопыток=0;
	 КонецЕсли; 
	 КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура АктивностьПриИзменении(Элемент)
	Объект.КоличествоПопыток=0;
КонецПроцедуры

ФОРМА АВТОРИЗАЦИИ

&НаСервере
Функция ВойтиНаСервере()

    Пользователь = Справочники.Пользователи.НайтиПоНаименованию(Логин, Истина);
    
    Если Пользователь.Пустая() Тогда
        Возврат Новый Структура("Успех,Сообщение", Ложь, "Пользователь не найден");
    КонецЕсли;
    
    Если НЕ Пользователь.Активность Тогда
        Возврат Новый Структура("Успех,Сообщение", Ложь, "Пользователь заблокирован");
    КонецЕсли;
    
    Если Пользователь.Пароль = Пароль Тогда
        ПользовательОбъект = Пользователь.ПолучитьОбъект();
        ПользовательОбъект.ДатаВхода = ТекущаяДата();
        ПользовательОбъект.Записать();
        
        Возврат Новый Структура("Успех,Роль,Пользователь,Сообщение", 
            Истина, Пользователь.Роль, Пользователь, "Успешная авторизация");
    Иначе
        Возврат Новый Структура("Успех,Сообщение", Ложь, "Неверный пароль");
    КонецЕсли;
    
КонецФункции

&НаКлиенте
Процедура Войти(Команда)
    
    Результат = ВойтиНаСервере();
    
    Если Результат.Успех Тогда
        Сообщить(Результат.Сообщение);
        
        Если Результат.Роль = ПредопределенноеЗначение("Перечисление.Роли.Пользователь") Тогда
            ОткрытьФорму("ОбщаяФорма.ФормаПользователя");
        ИначеЕсли Результат.Роль = ПредопределенноеЗначение("Перечисление.Роли.Администратор") Тогда
            ОткрытьФорму("Справочник.Пользователи.ФормаСписка");
        КонецЕсли;
        
        Этаформа.Закрыть();
    Иначе
        Сообщить(Результат.Сообщение);
    КонецЕсли;
    
КонецПроцедуры

МОДУЛЬ ВСЕЙ ПОДСИСТЕМЫ


Процедура ПриНачалеРаботыСистемы()
	ОткрытьФорму("ОбщаяФорма.ФормаАвторизации");
КонецПроцедуры
